<!DOCTYPE html>
<html>
  <head>
    <title>Who is the Impostor?</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
  </head>
  <body>
    <form onsubmit="event.preventDefault()">
      <input type="text" id="playerName" value="username" pattern="[\w]{3,10}" title="3-10 characters of A-z, 0-9, or _" onchange="changeName(this)"/>
    </form>
    <h2 id="playerRole"></h2>

    <hr>
    <h3>Players</h3>
    <ul id="votePlayers"></ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      
      function changeName(input) {
        socket.emit("changeName", input.value);
      }; changeName(playerName);
      function vote(player) {
        console.log(player);
        socket.emit("voteFor", player.parentElement.innerText);
      };
      socket.on("getPlayersNames", (players) => {
        votePlayers.replaceChildren();
        for (const player of Object.keys(players)) {
          const playerElement = document.createElement("li");
          const playerName = document.createTextNode(players[player].name);
          const votePlayer = document.createElement("button");
          votePlayer.innerText = "Vote";
          votePlayer.setAttribute("type", "button");
          votePlayer.setAttribute("onclick", "vote(this)");
          playerElement.appendChild(playerName);
          playerElement.appendChild(votePlayer);
          votePlayers.appendChild(playerElement);
        }
      });
      socket.on("getRole", (player) => {
        playerRole.innerText = player.role;
      });
    </script>
  </body>
</html>
